# Health-InfraOps Log Rotation Configuration
# Comprehensive log rotation for healthcare infrastructure

# Global settings
weekly
rotate 52
create
dateext
dateformat -%Y-%m-%d
compress
compresscmd /usr/bin/gzip
compressext .gz
compressoptions -9
delaycompress
missingok
notifempty

# Include custom app configurations
include /etc/logrotate.d/custom-apps/*.conf

# System logs
/var/log/syslog
/var/log/messages
/var/log/debug
/var/log/daemon.log
/var/log/kern.log
{
    rotate 7
    daily
    missingok
    notifempty
    delaycompress
    compress
    postrotate
        /usr/lib/rsyslog/rsyslog-rotate
    endscript
}

# Authentication logs
/var/log/auth.log
/var/log/secure
{
    rotate 4
    weekly
    missingok
    notifempty
    compress
    delaycompress
    postrotate
        /bin/kill -HUP `cat /var/run/rsyslogd.pid 2> /dev/null` 2> /dev/null || true
    endscript
}

# Nginx logs
/var/log/nginx/*.log {
    daily
    missingok
    rotate 52
    compress
    delaycompress
    notifempty
    create 0640 www-data adm
    sharedscripts
    postrotate
        if [ -f /var/run/nginx.pid ]; then
            kill -USR1 `cat /var/run/nginx.pid`
        fi
    endscript
}

# MySQL logs
/var/log/mysql/mysql.log
/var/log/mysql/mysql-slow.log
/var/log/mysql/error.log
{
    daily
    rotate 7
    missingok
    compress
    delaycompress
    notifempty
    create 640 mysql adm
    postrotate
        # if mysqld is running, switch to new log file
        if test -x /usr/bin/mysqladmin && \
           /usr/bin/mysqladmin ping &>/dev/null
        then
           /usr/bin/mysqladmin flush-logs
        fi
    endscript
}

# MongoDB logs
/var/log/mongodb/mongod.log
{
    daily
    rotate 7
    missingok
    compress
    delaycompress
    notifempty
    copytruncate
    create 640 mongodb mongodb
}

# Apache logs (if used)
/var/log/apache2/*.log {
    daily
    missingok
    rotate 52
    compress
    delaycompress
    notifempty
    create 640 root adm
    sharedscripts
    postrotate
        /etc/init.d/apache2 reload > /dev/null
    endscript
}

# Application logs (Node.js)
/var/log/nodejs/*.log
/opt/app/logs/*.log
{
    daily
    rotate 30
    missingok
    compress
    delaycompress
    notifempty
    copytruncate
    create 644 appuser appuser
}

# Docker container logs
/var/lib/docker/containers/*/*.log {
    daily
    rotate 7
    compress
    delaycompress
    missingok
    notifempty
    copytruncate
}

# Health InfraOps specific logs
/opt/health-infraops/logs/*.log
/opt/health-infraops/backups/logs/*.log
/opt/health-infraops/automation/logs/*.log
{
    daily
    rotate 30
    missingok
    compress
    delaycompress
    notifempty
    copytruncate
    create 644 infraops infraops
}

# Monitoring logs
/var/log/prometheus/*.log
/var/log/grafana/*.log
/var/log/alertmanager/*.log
{
    weekly
    rotate 8
    missingok
    compress
    delaycompress
    notifempty
    copytruncate
    create 644 prometheus prometheus
}

# Security monitoring logs
/var/log/fail2ban.log
/var/log/audit/audit.log
{
    weekly
    rotate 13
    missingok
    compress
    delaycompress
    notifempty
    copytruncate
}

# Backup logs
/var/log/backup/*.log
{
    daily
    rotate 14
    missingok
    compress
    delaycompress
    notifempty
    copytruncate
    create 644 backup backup
}

# Cron logs
/var/log/cron.log
{
    weekly
    rotate 4
    missingok
    compress
    delaycompress
    notifempty
}

# Mail logs
/var/log/mail.log
/var/log/mail.err
{
    weekly
    rotate 4
    missingok
    compress
    delaycompress
    notifempty
}

# Custom size-based rotation for large logs
/var/log/large-app/*.log {
    size 100M
    rotate 5
    missingok
    compress
    delaycompress
    notifempty
    copytruncate
    create 644 appuser appuser
}

# High-frequency application logs
/var/log/high-frequency/*.log {
    hourly
    rotate 24
    missingok
    compress
    delaycompress
    notifempty
    copytruncate
    create 644 appuser appuser
}

# Long-term archive logs
/var/log/archive/*.log {
    monthly
    rotate 12
    missingok
    compress
    delaycompress
    notifempty
    copytruncate
    create 644 root root
}

# Health InfraOps compliance logs (7-year retention for healthcare)
/var/log/compliance/*.log
/var/log/hipaa/*.log
{
    monthly
    rotate 84
    missingok
    compress
    delaycompress
    notifempty
    copytruncate
    create 600 root root
}

# Performance metrics logs
/var/log/metrics/*.log
{
    daily
    rotate 14
    missingok
    compress
    delaycompress
    notifempty
    copytruncate
    create 644 metrics metrics
}