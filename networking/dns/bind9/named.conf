// Health-InfraOps BIND9 Configuration
// Infokes Healthcare System DNS Server

options {
    // Basic settings
    directory "/var/cache/bind";
    version "Health-InfraOps DNS Server";
    
    // Network settings
    listen-on { 
        10.0.40.42; 
        127.0.0.1;
    };
    listen-on-v6 { none; };
    
    // Access control
    allow-query { 
        10.0.0.0/16;
        127.0.0.0/8;
    };
    allow-recursion { 
        10.0.0.0/16;
        127.0.0.0/8;
    };
    allow-transfer { 
        10.0.40.0/24;
        10.0.20.0/24;
    };
    
    // Forwarders for external DNS
    forwarders {
        8.8.8.8;
        8.8.4.4;
        1.1.1.1;
    };
    forward first;
    
    // Security settings
    dnssec-validation auto;
    auth-nxdomain no;
    
    // Performance settings
    max-cache-size 256M;
    max-udp-size 4096;
    
    // Logging
    statistics-file "/var/log/bind/named.stats";
};

// Logging configuration
logging {
    channel default_file {
        file "/var/log/bind/named.log" versions 3 size 5m;
        severity info;
        print-time yes;
        print-severity yes;
        print-category yes;
    };
    
    channel security_file {
        file "/var/log/bind/security.log" versions 3 size 5m;
        severity info;
        print-time yes;
        print-severity yes;
        print-category yes;
    };
    
    channel query_file {
        file "/var/log/bind/query.log" versions 3 size 5m;
        severity info;
        print-time yes;
        print-severity yes;
        print-category yes;
    };
    
    category default { default_file; };
    category security { security_file; };
    category queries { query_file; };
};

// Zone files
include "/etc/bind/named.conf.local";
include "/etc/bind/named.conf.default-zones";

// Access control lists
acl "internal-networks" {
    10.0.0.0/16;
    127.0.0.0/8;
};

acl "management-servers" {
    10.0.40.0/24;
};

// View for internal networks
view "internal" {
    match-clients { 
        internal-networks; 
        management-servers;
    };
    recursion yes;
    additional-from-auth yes;
    additional-from-cache yes;
    
    // Include internal zones
    include "/etc/bind/zones/internal/infokes.co.id.zone";
    include "/etc/bind/zones/internal/db.10.0";
    include "/etc/bind/zones/internal/db.20.0";
    include "/etc/bind/zones/internal/db.30.0";
    include "/etc/bind/zones/internal/db.40.0";
    include "/etc/bind/zones/internal/db.50.0";
};

// View for external (public) - if needed
view "external" {
    match-clients { any; };
    recursion no;
    
    // Include external zones
    include "/etc/bind/zones/external/infokes.co.id.zone";
};

// Control channel for rndc
controls {
    inet 127.0.0.1 port 953 allow { 127.0.0.1; } keys { "rndc-key"; };
    inet 10.0.40.42 port 953 allow { 10.0.40.0/24; } keys { "rndc-key"; };
};