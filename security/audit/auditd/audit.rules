# Health-InfraOps Audit Rules
# Comprehensive auditing for Infokes Healthcare System

## First rule - delete all existing rules
-D

## Increase the buffers to survive stress events.
## Make this bigger for busy systems
-b 8192

## Set failure mode to syslog
-f 1

## Ignore errors when reading audit rules
-i

## Health-InfraOps Specific Audit Rules

# Monitor SSH access and configuration
-w /etc/ssh/sshd_config -p wa -k sshd_config
-w /etc/ssh/ -p wa -k sshd
-a always,exit -F arch=b64 -S execve -F path=/usr/sbin/sshd -k sshd_access

# Monitor user authentication
-w /etc/passwd -p wa -k user_modification
-w /etc/group -p wa -k group_modification
-w /etc/shadow -p wa -k shadow_modification
-w /etc/gshadow -p wa -k gshadow_modification
-w /etc/security/opasswd -p wa -k opasswd

# Monitor sudo and privilege escalation
-w /etc/sudoers -p wa -k sudoers
-w /etc/sudoers.d/ -p wa -k sudoers
-a always,exit -F arch=b64 -S execve -F path=/usr/bin/sudo -k sudo_exec

# Monitor system time changes
-a always,exit -F arch=b64 -S adjtimex -S settimeofday -S clock_settime -k time_change
-w /etc/localtime -p wa -k time_change

# Monitor network configuration
-w /etc/hosts -p wa -k hosts_file
-w /etc/hostname -p wa -k hostname
-w /etc/network/ -p wa -k network_config
-a always,exit -F arch=b64 -S sethostname -S setdomainname -k network_config

# Monitor system startup and services
-w /etc/init.d/ -p wa -k init_scripts
-w /etc/systemd/ -p wa -k systemd
-w /etc/rc.local -p wa -k rc_local

# Monitor kernel module loading/unloading
-w /sbin/insmod -p x -k modules
-w /sbin/rmmod -p x -k modules
-w /sbin/modprobe -p x -k modules
-a always,exit -F arch=b64 -S init_module -S delete_module -k modules

# Monitor file system mounts
-a always,exit -F arch=b64 -S mount -S umount2 -k mounts

# Monitor file deletion
-a always,exit -F arch=b64 -S unlink -S unlinkat -S rename -S renameat -k delete

# Monitor process and session initiation
-w /var/run/utmp -p wa -k session
-w /var/log/wtmp -p wa -k session
-w /var/log/btmp -p wa -k session
-w /var/log/lastlog -p wa -k session

# Health-InfraOps Application Monitoring

# Monitor web application files
-w /var/www/infokes/ -p wa -k infokes_app
-w /opt/infokes/ -p wa -k infokes_app

# Monitor database access
-a always,exit -F arch=b64 -S execve -F path=/usr/bin/mysql -k mysql_access
-a always,exit -F arch=b64 -S execve -F path=/usr/bin/psql -k postgres_access
-w /etc/mysql/ -p wa -k mysql_config
-w /etc/postgresql/ -p wa -k postgres_config

# Monitor backup operations
-a always,exit -F arch=b64 -S execve -F path=/usr/bin/rsync -k backup_ops
-a always,exit -F arch=b64 -S execve -F path=/usr/bin/tar -k backup_ops
-w /etc/backup/ -p wa -k backup_config

# Monitor SSL/TLS certificates
-w /etc/ssl/ -p wa -k ssl_certs
-w /etc/ssl/health-infraops-ca/ -p wa -k ca_certs

# Monitor monitoring system
-a always,exit -F arch=b64 -S execve -F path=/usr/bin/prometheus -k monitoring
-a always,exit -F arch=b64 -S execve -F path=/usr/bin/grafana -k monitoring
-w /etc/prometheus/ -p wa -k prometheus_config
-w /etc/grafana/ -p wa -k grafana_config

# Monitor load balancer
-a always,exit -F arch=b64 -S execve -F path=/usr/sbin/haproxy -k haproxy
-a always,exit -F arch=b64 -S execve -F path=/usr/sbin/nginx -k nginx
-w /etc/haproxy/ -p wa -k haproxy_config
-w /etc/nginx/ -p wa -k nginx_config

# Monitor security tools
-a always,exit -F arch=b64 -S execve -F path=/usr/bin/fail2ban-server -k fail2ban
-a always,exit -F arch=b64 -S execve -F path=/usr/sbin/auditd -k auditd
-w /etc/fail2ban/ -p wa -k fail2ban_config
-w /etc/audit/ -p wa -k audit_config

# Monitor cron jobs
-w /etc/cron.allow -p wa -k cron
-w /etc/cron.deny -p wa -k cron
-w /etc/cron.d/ -p wa -k cron
-w /etc/cron.daily/ -p wa -k cron
-w /etc/cron.hourly/ -p wa -k cron
-w /etc/cron.monthly/ -p wa -k cron
-w /etc/cron.weekly/ -p wa -k cron
-w /etc/crontab -p wa -k cron
-w /var/spool/cron/ -p wa -k cron

# Monitor system logs
-w /var/log/ -p wa -k logs
-w /var/log/auth.log -p wa -k auth_logs
-w /var/log/syslog -p wa -k syslog
-w /var/log/audit/ -p wa -k audit_logs

# Monitor temporary file systems
-w /tmp/ -p wa -k tmp_files
-w /var/tmp/ -p wa -k tmp_files

# Monitor kernel and system calls
-a always,exit -F arch=b64 -S chmod -F auid>=1000 -F auid!=4294967295 -k perm_chmod
-a always,exit -F arch=b64 -S chown -F auid>=1000 -F auid!=4294967295 -k perm_chown
-a always,exit -F arch=b64 -S setxattr -F auid>=1000 -F auid!=4294967295 -k perm_setxattr

# Monitor privilege escalation
-a always,exit -F arch=b64 -S setuid -S setgid -S setreuid -S setregid -S setresuid -S setresgid -k priv_esc

# Monitor container operations (if using Docker)
-w /usr/bin/docker -p x -k docker
-w /var/lib/docker -p wa -k docker
-w /etc/docker -p wa -k docker
-w /usr/bin/docker-containerd -p x -k docker
-w /usr/bin/docker-runc -p x -k docker

# Health-InfraOps Compliance Rules

# HIPAA Compliance - Access to medical records
-a always,exit -F arch=b64 -S open -S openat -F dir=/var/www/infokes/medical-records -k hipaa_access

# PCI DSS Compliance - Financial data access
-a always,exit -F arch=b64 -S open -S openat -F dir=/var/www/infokes/payment -k pci_access

# GDPR Compliance - Personal data access
-a always,exit -F arch=b64 -S open -S openat -F dir=/var/www/infokes/personal-data -k gdpr_access

# Make the configuration immutable
-e 2