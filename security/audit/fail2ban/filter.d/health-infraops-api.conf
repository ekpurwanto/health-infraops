# Health-InfraOps API Fail2Ban Filter
# Custom filter for Infokes Healthcare System API endpoints

[Definition]
# API authentication failures
failregex = ^<HOST> -.*POST.*/api/v1/auth/login.* 40[0-9]
            ^<HOST> -.*POST.*/api/v1/auth/login.* 50[0-9]
            ^<HOST> -.*Invalid API key.*
            ^<HOST> -.*Authentication failed.*
            ^<HOST> -.*Token validation failed.*
            ^<HOST> -.*POST.*/api/.* 401$
            ^<HOST> -.*POST.*/api/.* 403$

# API rate limiting violations
failregex = ^<HOST> -.*GET.*/api/.* 429$
            ^<HOST> -.*POST.*/api/.* 429$
            ^<HOST> -.*Rate limit exceeded.*
            ^<HOST> -.*Too many requests.*

# SQL injection attempts
failregex = ^<HOST> -.*SELECT.*FROM.*
            ^<HOST> -.*UNION.*SELECT.*
            ^<HOST> -.*DROP.*TABLE.*
            ^<HOST> -.*INSERT.*INTO.*
            ^<HOST> -.*UPDATE.*SET.*
            ^<HOST> -.*DELETE.*FROM.*

# XSS and injection attempts
failregex = ^<HOST> -.*<script>.*
            ^<HOST> -.*javascript:.*
            ^<HOST> -.*onmouseover=.*
            ^<HOST> -.*alert\(.*\).*
            ^<HOST> -.*eval\(.*\).*

# Directory traversal attempts
failregex = ^<HOST> -.*\.\./.*
            ^<HOST> -.*\.\.%2f.*
            ^<HOST> -.*\.\.%5c.*

# Health-InfraOps specific patterns
failregex = ^<HOST> -.*Unauthorized access to patient data.*
            ^<HOST> -.*Invalid medical record access.*
            ^<HOST> -.*Suspicious appointment modification.*
            ^<HOST> -.*Prescription access violation.*

# API endpoint brute force
failregex = ^<HOST> -.*POST /api/v1/patients.* 40[0-9]
            ^<HOST> -.*GET /api/v1/medical-records.* 40[0-9]
            ^<HOST> -.*POST /api/v1/appointments.* 40[0-9]

ignoreregex = 

[Init]
# Maximum lines to buffer
maxlines = 10

# Date pattern (adjust based on your log format)
datepattern = ^%%Y-%%m-%%d %%H:%%M:%%S