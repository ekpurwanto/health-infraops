# Health-InfraOps Infokes SSL Virtual Host

<VirtualHost *:443>
    ServerName infokes.co.id
    ServerAlias www.infokes.co.id
    ServerAdmin admin@infokes.co.id
    DocumentRoot /var/www/infokes/public

    # SSL Configuration
    SSLEngine on
    SSLCertificateFile /etc/ssl/certs/infokes.co.id.crt
    SSLCertificateKeyFile /etc/ssl/private/infokes.co.id.key
    SSLCertificateChainFile /etc/ssl/certs/ca-bundle.crt

    # SSL Protocols
    SSLProtocol all -SSLv3 -TLSv1 -TLSv1.1
    SSLCipherSuite ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384
    SSLHonorCipherOrder off
    SSLSessionTickets off

    # Security Headers
    Header always set Strict-Transport-Security "max-age=63072000; includeSubDomains; preload"
    Header always set X-Content-Type-Options nosniff
    Header always set X-Frame-Options DENY
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"

    # Proxy settings for application
    ProxyPreserveHost On
    ProxyPass /api/ http://10.0.10.13:8000/ retry=0
    ProxyPassReverse /api/ http://10.0.10.13:8000/

    # Static files
    Alias /static/ /var/www/infokes/static/
    <Directory "/var/www/infokes/static/">
        Require all granted
        Options -Indexes
        ExpiresActive On
        ExpiresDefault "access plus 1 year"
    </Directory>

    # Media files
    Alias /media/ /var/www/infokes/media/
    <Directory "/var/www/infokes/media/">
        Require all granted
        Options -Indexes
        ExpiresActive On
        ExpiresDefault "access plus 6 months"
    </Directory>

    # Health check
    <Location /health>
        Require all granted
        ProxyPass !
    </Location>

    # Logging
    ErrorLog ${APACHE_LOG_DIR}/infokes_ssl_error.log
    CustomLog ${APACHE_LOG_DIR}/infokes_ssl_access.log combined

    <Directory "/var/www/infokes/public">
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted

        # Security
        <Files ".ht*">
            Require all denied
        </Files>
    </Directory>
</VirtualHost>

# HTTP to HTTPS redirect
<VirtualHost *:80>
    ServerName infokes.co.id
    ServerAlias www.infokes.co.id
    
    RewriteEngine On
    RewriteCond %{HTTPS} off
    RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
    
    # Security headers for redirect
    Header always set Strict-Transport-Security "max-age=63072000; includeSubDomains; preload"
</VirtualHost>